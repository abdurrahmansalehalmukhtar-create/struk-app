<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Struk Transaksi</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial; font-size: 10px; margin:0; padding:10px; background:#f0f0f0; }
    .struk { width: 58mm; padding: 3px 5px; background: #fff; margin: 0 auto; }
    h3, p { margin: 0; text-align:center; }

    .nama-usaha { font-size:13px; font-weight:bold; margin-bottom:2px; }
    .alamat-usaha { font-size:12px; font-weight:normal; margin-bottom:5px; }

    .left { text-align:left; }
    pre { font-size:10px; white-space:pre-wrap; word-wrap:break-word; margin:2px 0; }
    hr { border:0; border-top:1px dashed #000; margin:3px 0; }

    /* âœ… Tambahan biar print-nya ukuran 58mm bukan A4 */
    @page {
      size: 58mm auto;
      margin: 0;
    }

    @media print {
      body {
        margin: 0;
        background: white;
      }
      .struk {
        width: 58mm;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <div class="struk" id="struk">
    <h3 id="NamaUsaha" class="nama-usaha"></h3>
    <p id="AlamatUsaha" class="alamat-usaha"></p>
    <hr>
    <p class="left">Tanggal : <span id="Tanggal"></span></p>
    <p class="left">Kasir   : <span id="NamaPelanggan"></span></p>
    <p class="left">Metode  : <span id="MetodePembayaran"></span></p>
    <hr>
    <pre id="RincianCetak"></pre>
    <hr>
    <p class="left">TOTAL     : <span id="TotalTagihan"></span></p>
    <p class="left">DIBAYAR   : <span id="TotalPembayaran"></span></p>
    <p class="left">KEMBALIAN : <span id="Kembalian"></span></p>
    <hr>
    <p id="CatatanPenjualan"></p>
  </div>

  <script>
    const p = new URLSearchParams(window.location.search);

    // Isi data AppSheet / default
    document.getElementById('NamaUsaha').innerText    = p.get('NamaUsaha') || "Nama Usaha Contoh";
    document.getElementById('AlamatUsaha').innerText  = p.get('AlamatUsaha') || "Jl. Contoh No.1, Kota Contoh";
    document.getElementById('Tanggal').innerText      = p.get('Tanggal') || "21/09/2025";
    document.getElementById('NamaPelanggan').innerText= p.get('NamaPelanggan') || "Budi";
    document.getElementById('MetodePembayaran').innerText = p.get('MetodePembayaran') || "Tunai";
    document.getElementById('RincianCetak').innerText = p.get('RincianCetak') ||
`1x Nasi Goreng - 25.000
2x Ayam Goreng - 40.000
3x Es Teh Manis - 15.000`;
    document.getElementById('TotalTagihan').innerText = p.get('TotalTagihan') || "105.000";
    document.getElementById('TotalPembayaran').innerText = p.get('TotalPembayaran') || "110.000";
    document.getElementById('Kembalian').innerText    = p.get('Kembalian') || "5.000";
    document.getElementById('CatatanPenjualan').innerText = p.get('CatatanPenjualan') || "Terima kasih atas kunjungan Anda!";

    // Auto-generate PDF & print
    window.onload = async function() {
      const { jsPDF } = window.jspdf;
      const struk = document.getElementById('struk');

      const rect = struk.getBoundingClientRect();
      const contentHeightMM = rect.height * 0.264583; // px -> mm

      const doc = new jsPDF({
        unit: 'mm',
        format: [58, contentHeightMM + 10] // lebar 58mm, tinggi sesuai isi + margin
      });

      await doc.html(struk, {
        x: 0, y: 0, width: 58,
        callback: function(pdf) {
          const pdfBlob = pdf.output('bloburl'); // PDF sebagai URL sementara
          const printWindow = window.open(pdfBlob); // buka PDF di tab baru
          if (printWindow) {
            printWindow.print(); // langsung print
          } else {
            alert("Browser memblokir popup! Izinkan popup untuk melihat PDF.");
          }
        }
      });
    }
  </script>

</body>
</html>
